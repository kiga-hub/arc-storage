# 生产环境平台数据生命周期管理

### 数据

#### 1. 原始数据
- arc未经处理的原始数据

#### 2. 文件
- 数据类型:arc

### 3. 时序数据
- 使用TDEngine保存所有时序型数据
- 解包及其他实时处理数据信息
- 记录数据迁移的时间

### 4. 容器日志
- 所有Docker服务输出的日志

### 5. 系统日志
- 硬件信息
- 软件信息
- 系统问题信息

### 6. 应用日志
- 程序执行过程输出日志(INFO、DEBUG、ERROR)

### 7. 度量数据
- Prometheus

### 8. 链路分析
- Tracing

### 9. 备份数据
- 同步写入的文件
- 数据库导出的文件

### 硬件

#### U盘
- 硬件类型:U
- 尺寸:90×54mm
- 容量:128G、256G、512G、1T
- 读写速度:15-80M/s

#### 外置磁盘阵列
- 硬件类型:机械硬盘
- 接口:USB3.0
- 转速:5400rpm、7200rpm
- 尺寸:3.5寸
- 容量:2盘位,32TB,RAID JBOD
- 读写速度:文件未使用脚本打包情况(40～60MB/s),用脚本打包后传输速率(150~300MB/s)。

#### 主机存储(刀片机热插拔硬盘)
- 硬件类型:机械硬盘
- 接口:Sata3.0/SAS
- 转速:5400rpm、7200rpm
- 尺寸:3.5寸
- 容量:3盘位以上为一组,每组48TB,做软RAID5 = (n-1)*16 TB,n = 硬盘个数
- 读写速度:突发速率600MB/s,平均速率-待实测

#### 独立存储服务器
- 待定

#### 云存储
- Storage Cloud Service(OSS)

### 其他因素

#### 资源成本(资金、设备、时间、人力)
- 物理距离考量(部署现场-公司路程)
- 数据迁移周期(取回数据-天、月、年为单位)
- 数据迁移耗时(拷贝时间)
- 资金

#### 不可抗力因素
- 设备运输途中,发生磕碰导致数据丢失
- 数据迁移出现错误或失败

----------------------------------------------------------------

## 三. 具体可选方案

### Solution A

>硬件选择
- 使用外置磁盘阵列,USB3.0接口进行数据迁移

>数据生命周期

-

>数据迁移
- 每次迁移数据的时间记为1个周期,时长为N,周期单位N:天、月、年。
- N = 数据拷贝、数据库导出、脚本拷贝日志以及更换外置硬盘的时间。

>数据清理
```bash
-----------|——————————|————————|——————————|———————>
4N        3N         2N        N         Now    Runing
```
- Now: 开始迁移日期,迁移数据的时间范围为N-Now 
- N~Now: 要迁移的数据范围
- 3N-N: 为预留时长
- 数据保留时长M = N+2或3N,清理3N之前的所有数据

## 六. 术语

- 增量拷贝:仅拷贝有变动的文件部分,从上一次拷贝结束的时间-当前时间。

- 同步写入: 同一线程执行保存文件,按顺序数据将被复制成完全相同的两份,写入文件的时间戳一致。

- RAID:磁盘阵列(Redundant Arrays of Independent Disks,RAID) https://baike.baidu.com/item/%E7%A3%81%E7%9B%98%E9%98%B5%E5%88%97/1149823?fromtitle=RAID&fromid=33858 

- rpm:硬盘转速,以每分钟多少转来表示。单位表示为RPM,RPM是Revolutions per minute的缩写,是转/每分钟。RPM值越大,内部传输率就越快,访问时间就越短,硬盘的整体性能也就越好。

- USB3.0 :Universal Serial Bus(通用串行总线)。USB 3.0是一种USB规范,USB2.0的最大传输带宽为480Mbps（即60MB/s）,而USB3.0的最大传输带宽高达5.0Gbps（500MB/s）。

- Sata3:SerialATA Revision3.0 specificationv(串行ATA规格第三版)。6Gbps(750MB/s)只是理论值,事实上SATA接口发送信息的速度为600MB/s,而受制于系统各部件的影响,实际速度会更低一些,而且不同环境差异会很大。

- TDEngine: 全栈时序数据处理引擎。https://www.taosdata.com/cn/documentation/

- taosdump: TDEngine数据导入导出工具。

- OSS:云对象存储(Object Storage Service)。与平台无关的RESTful API接口,可以在任何应用、任何时间、任何地点存储和访问任意类型的数据。

- 异步拷贝(复制)：所有在主存中的数据,拷贝到另一个硬盘中。如果发生失效,第一个服务器的硬盘上的被提交数据可能会丢失。

- 突发速率:(接口传输率,外部数据传输率),数据最高传输率。

- 备份:备份的意思就是不仅可以把重要文件COPY复制文件，也可以做成一个压缩或其它格式文件，许多文件也可以备份成一个文件。

- Cephfs:优秀的性能、可靠性和可扩展性而设计的统一的、分布式文件系统。支持块存储、文件存储、对象存储。
  